<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ec4899">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Track your menstrual cycle">
    <title>Period Tracker</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.ico">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script>
        const { useState, useEffect, createElement: h } = React;

        function PeriodTracker() {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [periods, setPeriods] = useState({});
            const [selectedDate, setSelectedDate] = useState(null);
            const [showWarning, setShowWarning] = useState(false);
            const [pendingMark, setPendingMark] = useState(null);

            useEffect(() => {
                const saved = localStorage.getItem('periodData');
                if (saved) {
                    setPeriods(JSON.parse(saved));
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('periodData', JSON.stringify(periods));
            }, [periods]);

            const getMonthData = (date) => {
                const year = date.getFullYear();
                const month = date.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startPadding = firstDay.getDay();
                const daysInMonth = lastDay.getDate();
                
                return { year, month, startPadding, daysInMonth };
            };

            const formatDateKey = (date) => {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            };

            const isInPeriod = (dateKey) => {
                const dates = Object.entries(periods).sort(([a], [b]) => a.localeCompare(b));
                
                for (let i = 0; i < dates.length; i++) {
                    const [date, type] = dates[i];
                    
                    if (type === 'start') {
                        const nextDate = dates[i + 1];
                        
                        if (nextDate) {
                            const [nextKey, nextType] = nextDate;
                            if (nextType === 'end') {
                                if (dateKey > date && dateKey < nextKey) {
                                    return true;
                                }
                            }
                        }
                    }
                }
                
                return false;
            };

            const handleDateClick = (day) => {
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                const key = formatDateKey(date);
                setSelectedDate(key);
            };

            const markPeriod = (type) => {
                if (!selectedDate) return;
                
                const updatedPeriods = { ...periods, [selectedDate]: type };
                const dates = Object.entries(updatedPeriods).sort(([a], [b]) => a.localeCompare(b));
                
                let needsWarning = false;
                
                for (let i = 0; i < dates.length; i++) {
                    const [date, markType] = dates[i];
                    
                    if (markType === 'start') {
                        const nextDate = dates[i + 1];
                        
                        if (nextDate && nextDate[1] === 'end') {
                            const [endKey] = nextDate;
                            const startTime = new Date(date).getTime();
                            const endTime = new Date(endKey).getTime();
                            const daysDiff = Math.ceil((endTime - startTime) / (1000 * 60 * 60 * 24));
                            
                            if (daysDiff > 10) {
                                needsWarning = true;
                                break;
                            }
                        }
                    }
                }
                
                if (needsWarning) {
                    setPendingMark({ type, date: selectedDate });
                    setShowWarning(true);
                } else {
                    setPeriods(updatedPeriods);
                    setSelectedDate(null);
                }
            };

            const confirmMark = () => {
                if (pendingMark) {
                    setPeriods(prev => ({
                        ...prev,
                        [pendingMark.date]: pendingMark.type
                    }));
                }
                setShowWarning(false);
                setPendingMark(null);
                setSelectedDate(null);
            };

            const cancelMark = () => {
                setShowWarning(false);
                setPendingMark(null);
            };

            const removeMark = () => {
                if (!selectedDate) return;
                
                setPeriods(prev => {
                    const updated = { ...prev };
                    delete updated[selectedDate];
                    return updated;
                });
                setSelectedDate(null);
            };

            const navigateMonth = (direction) => {
                setCurrentDate(prev => {
                    const newDate = new Date(prev);
                    newDate.setMonth(prev.getMonth() + direction);
                    return newDate;
                });
                setSelectedDate(null);
            };

            const canGoForward = () => {
                const now = new Date();
                const next = new Date(currentDate);
                next.setMonth(currentDate.getMonth() + 1);
                return next <= now;
            };

            const canGoBack = () => {
                const sixMonthsAgo = new Date();
                sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
                const prev = new Date(currentDate);
                prev.setMonth(currentDate.getMonth() - 1);
                return prev >= sixMonthsAgo;
            };

            const { year, month, startPadding, daysInMonth } = getMonthData(currentDate);
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                'July', 'August', 'September', 'October', 'November', 'December'];
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            const isToday = (day) => {
                const today = new Date();
                return today.getFullYear() === year && 
                       today.getMonth() === month && 
                       today.getDate() === day;
            };

            return h('div', { className: 'min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 p-4' },
                h('div', { className: 'max-w-md mx-auto' },
                    h('div', { className: 'bg-white rounded-3xl shadow-2xl overflow-hidden' },
                        // Header
                        h('div', { className: 'bg-gradient-to-r from-pink-500 via-purple-500 to-pink-400 p-6 text-white' },
                            h('h1', { className: 'text-2xl font-bold text-center mb-6' }, 'Period Tracker'),
                            h('div', { className: 'flex items-center justify-between' },
                                h('button', {
                                    onClick: () => navigateMonth(-1),
                                    disabled: !canGoBack(),
                                    className: 'p-2 rounded-full hover:bg-white/20 disabled:opacity-30 disabled:cursor-not-allowed transition'
                                }, '←'),
                                h('h2', { className: 'text-xl font-semibold' }, `${monthNames[month]} ${year}`),
                                h('button', {
                                    onClick: () => navigateMonth(1),
                                    disabled: !canGoForward(),
                                    className: 'p-2 rounded-full hover:bg-white/20 disabled:opacity-30 disabled:cursor-not-allowed transition'
                                }, '→')
                            )
                        ),
                        // Calendar
                        h('div', { className: 'p-4' },
                            h('div', { className: 'grid grid-cols-7 gap-2 mb-2' },
                                ...dayNames.map(day => h('div', { key: day, className: 'text-center text-xs font-semibold text-gray-500 py-2' }, day))
                            ),
                            h('div', { className: 'grid grid-cols-7 gap-2' },
                                ...Array.from({ length: startPadding }).map((_, i) => h('div', { key: `empty-${i}`, className: 'aspect-square' })),
                                ...Array.from({ length: daysInMonth }).map((_, i) => {
                                    const day = i + 1;
                                    const dateKey = formatDateKey(new Date(year, month, day));
                                    const periodType = periods[dateKey];
                                    const inPeriod = isInPeriod(dateKey);
                                    const selected = selectedDate === dateKey;
                                    const today = isToday(day);

                                    let className = 'aspect-square rounded-full flex items-center justify-center text-sm font-medium transition-all ';
                                    if (selected) {
                                        className += 'bg-yellow-400 text-gray-900 scale-110 shadow-lg ring-4 ring-yellow-200';
                                    } else if (periodType === 'start') {
                                        className += 'bg-gradient-to-br from-pink-400 to-pink-500 text-white shadow-md';
                                    } else if (periodType === 'end') {
                                        className += 'bg-gradient-to-br from-purple-400 to-purple-500 text-white shadow-md';
                                    } else if (inPeriod) {
                                        className += 'bg-gradient-to-br from-pink-200 to-purple-200 text-gray-700 shadow-sm';
                                    } else if (today) {
                                        className += 'bg-blue-100 text-blue-600 font-bold';
                                    } else {
                                        className += 'hover:bg-gray-100 text-gray-700';
                                    }

                                    return h('button', {
                                        key: day,
                                        onClick: () => handleDateClick(day),
                                        className
                                    }, day);
                                })
                            )
                        ),
                        // Action Panel
                        selectedDate && !showWarning && h('div', { className: 'bg-gradient-to-r from-pink-50 to-purple-50 p-6 border-t border-gray-200' },
                            h('p', { className: 'text-center text-sm text-gray-600 mb-4 font-medium' },
                                new Date(selectedDate).toLocaleDateString('en-US', { 
                                    weekday: 'long', 
                                    year: 'numeric', 
                                    month: 'long', 
                                    day: 'numeric' 
                                })
                            ),
                            h('div', { className: 'flex gap-3' },
                                h('button', {
                                    onClick: () => markPeriod('start'),
                                    className: 'flex-1 bg-gradient-to-r from-pink-500 to-pink-600 text-white py-3 px-4 rounded-xl font-semibold hover:from-pink-600 hover:to-pink-700 transition shadow-md'
                                }, 'Start'),
                                h('button', {
                                    onClick: () => markPeriod('end'),
                                    className: 'flex-1 bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 px-4 rounded-xl font-semibold hover:from-purple-600 hover:to-purple-700 transition shadow-md'
                                }, 'End'),
                                h('button', {
                                    onClick: removeMark,
                                    className: 'flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-xl font-semibold hover:bg-gray-300 transition'
                                }, 'Clear')
                            )
                        ),
                        // Warning Dialog
                        showWarning && h('div', { className: 'bg-amber-50 border-t-4 border-amber-400 p-6' },
                            h('div', { className: 'flex items-start gap-3 mb-4' },
                                h('div', { className: 'flex-shrink-0 w-8 h-8 bg-amber-400 rounded-full flex items-center justify-center text-white font-bold text-lg' }, '!'),
                                h('div', {},
                                    h('h3', { className: 'font-bold text-amber-900 mb-1' }, 'Long Period Detected'),
                                    h('p', { className: 'text-sm text-amber-800' }, 'This will mark a period longer than 10 days. Are you sure this is correct?')
                                )
                            ),
                            h('div', { className: 'flex gap-3' },
                                h('button', {
                                    onClick: confirmMark,
                                    className: 'flex-1 bg-amber-500 text-white py-3 px-4 rounded-xl font-semibold hover:bg-amber-600 transition shadow-md'
                                }, 'Yes, Continue'),
                                h('button', {
                                    onClick: cancelMark,
                                    className: 'flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-xl font-semibold hover:bg-gray-300 transition'
                                }, 'Cancel')
                            )
                        ),
                        // Legend
                        h('div', { className: 'p-6 bg-gray-50 border-t border-gray-200' },
                            h('div', { className: 'flex items-center justify-center gap-6 text-sm' },
                                h('div', { className: 'flex items-center gap-2' },
                                    h('div', { className: 'w-6 h-6 rounded-full bg-gradient-to-br from-pink-400 to-pink-500 shadow-sm' }),
                                    h('span', { className: 'text-gray-600 font-medium' }, 'Start')
                                ),
                                h('div', { className: 'flex items-center gap-2' },
                                    h('div', { className: 'w-6 h-6 rounded-full bg-gradient-to-br from-pink-200 to-purple-200 shadow-sm' }),
                                    h('span', { className: 'text-gray-600 font-medium' }, 'Period')
                                ),
                                h('div', { className: 'flex items-center gap-2' },
                                    h('div', { className: 'w-6 h-6 rounded-full bg-gradient-to-br from-purple-400 to-purple-500 shadow-sm' }),
                                    h('span', { className: 'text-gray-600 font-medium' }, 'End')
                                )
                            )
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(React.createElement(PeriodTracker));

        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => console.log('SW registered:', registration))
                    .catch(error => console.log('SW registration failed:', error));
            });
        }
    </script>
</body>
</html>